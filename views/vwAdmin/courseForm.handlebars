<div class="d-flex justify-content-between align-items-center pt-3 pb-2 mb-3 border-bottom">
  <h1 class="h2">{{title}}</h1>
  <a href="/admin/courses" class="btn btn-sm btn-outline-secondary">
    <i class="bi bi-arrow-left"></i> Back
  </a>
</div>

{{#if error}}
<div class="alert alert-warning alert-dismissible fade show" role="alert">
  <strong>Error:</strong> Something went wrong. Please try again.
  <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
</div>
{{/if}}

{{#if success}}
<div class="alert alert-success alert-dismissible fade show" role="alert">
  <strong>Success:</strong> Changes saved successfully.
  <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
</div>
{{/if}}

{{#if (eq instructors.length 0)}}
<div class="alert alert-warning">
  <h5 class="mb-1"><i class="bi bi-exclamation-triangle"></i> No instructors available</h5>
  <p class="mb-2">Please create at least one instructor before creating a course.</p>
  <a href="/admin/users" class="btn btn-primary btn-sm">
    <i class="bi bi-person-plus"></i> Create Instructor
  </a>
</div>
{{/if}}

<form method="post" action="{{formAction}}" enctype="multipart/form-data" id="frmCourse" {{#if (eq instructors.length
  0)}}class="opacity-50" {{/if}}>

  <div class="row">
    <div class="col-md-8">
      <div class="card shadow-sm mb-4">
        <div class="card-header bg-white">
          <h5 class="card-title mb-0">Basic Information</h5>
        </div>
        <div class="card-body">

          <div class="mb-3">
            <label for="title" class="form-label">Course Title *</label>
            <input type="text" class="form-control" id="title" name="title" value="{{course.title}}" required {{#if (eq
              instructors.length 0)}}disabled{{/if}}>
          </div>

          <div class="mb-3">
            <label for="short_description" class="form-label">Short Description</label>
            <textarea class="form-control" id="short_description" name="short_description" rows="3" {{#if (eq
              instructors.length 0)}}disabled{{/if}}>{{course.short_description}}</textarea>
          </div>

          <div class="mb-3">
            <label for="detailed_description" class="form-label">Detailed Description</label>
            <textarea class="form-control" id="detailed_description" name="detailed_description" rows="6" {{#if (eq
              instructors.length 0)}}disabled{{/if}}>{{course.detailed_description}}</textarea>
          </div>

          <div class="row">
            <div class="col-md-6 mb-3">
              <label for="price" class="form-label">Original Price *</label>
              <input type="number" class="form-control" id="price" name="price" step="0.01" min="0"
                value="{{course.price}}" required {{#if (eq instructors.length 0)}}disabled{{/if}}>
            </div>

            <div class="col-md-6 mb-3">
              <label for="promotional_price" class="form-label">Promotional Price</label>
              <input type="number" class="form-control" id="promotional_price" name="promotional_price" step="0.01"
                min="0" value="{{course.promotional_price}}" {{#if (eq instructors.length 0)}}disabled{{/if}}>
            </div>
          </div>

        </div>
      </div>
    </div>

    <div class="col-md-4">
      <div class="card shadow-sm mb-4">
        <div class="card-header bg-white">
          <h5 class="card-title mb-0">Settings</h5>
        </div>
        <div class="card-body">

          <div class="mb-3">
            <label for="instructor_id" class="form-label">Instructor *</label>
            {{#if (gt instructors.length 0)}}
            <select class="form-select" id="instructor_id" name="instructor_id" required>
              <option value="">Select Instructor</option>
              {{#each instructors}}
              <option value="{{this.id}}" {{#if (eq this.id ../course.instructor_id)}}selected{{/if}}>
                {{this.full_name}} ({{this.email}})
              </option>
              {{/each}}
            </select>
            {{else}}
            <div class="text-muted small">No instructors available</div>
            {{/if}}
          </div>

          <div class="mb-3">
            <label for="category_id" class="form-label">Category</label>
            <select class="form-select" id="category_id" name="category_id" {{#if (eq instructors.length
              0)}}disabled{{/if}}>
              <option value="">Select Category</option>
              {{#each categories}}
              <option value="{{this.id}}" {{#if (eq this.id ../course.category_id)}}selected{{/if}}>{{this.name}}
              </option>
              {{/each}}
            </select>
          </div>

          <div class="mb-3">
            <label for="status" class="form-label">Status</label>
            <select class="form-select" id="status" name="status" {{#if (eq instructors.length 0)}}disabled{{/if}}>
              <option value="draft" {{#if (eq course.status "draft" )}}selected{{/if}}>Draft</option>
              <option value="published" {{#if (eq course.status "published" )}}selected{{/if}}>Published</option>
              <option value="completed" {{#if (eq course.status "completed" )}}selected{{/if}}>Completed</option>
            </select>
          </div>

        </div>
      </div>

      <div class="card shadow-sm">
        <div class="card-header bg-white">
          <h5 class="card-title mb-0">Course Image</h5>
        </div>
        <div class="card-body">

          {{#if course.image_url}}
          <div class="mb-3">
            <label class="form-label">Current Image</label>
            <img src="{{course.image_url}}" class="img-thumbnail" style="max-height: 200px;"
              onerror="this.src='https://via.placeholder.com/300x200?text=No+Image';">
          </div>
          {{/if}}

          <div class="mb-3">
            <label for="course_image" class="form-label">Upload Image</label>
            <input type="file" class="form-control" id="course_image" name="course_image" accept="image/*" {{#if (eq
              instructors.length 0)}}disabled{{/if}}>
            <div class="form-text">Allowed: JPG, PNG, GIF â€” Max 5MB.</div>
          </div>

          <div id="image-preview-container" class="d-none">
            <label class="form-label">Preview</label>
            <img id="image-preview" class="img-thumbnail" style="max-height: 200px;">
          </div>

        </div>
      </div>
    </div>
  </div>

  <div class="text-end mt-3">
    <button type="submit" class="btn btn-primary" {{#if (eq instructors.length 0)}}disabled{{/if}}>
      <i class="bi bi-check-lg"></i> {{#if course.id}}Update{{else}}Create Course{{/if}}
    </button>
    <a href="/admin/courses" class="btn btn-secondary">Cancel</a>
  </div>

</form>