<div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
  <h1 class="h2">{{title}}</h1>
  <div class="btn-toolbar mb-2 mb-md-0">
    <a href="/admin/categories" class="btn btn-sm btn-outline-secondary">
      <i class="bi bi-arrow-left"></i> Back
    </a>
  </div>
</div>

{{#if error}}
<div class="alert alert-warning alert-dismissible fade show" role="alert">
  <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
  <strong>Error:</strong> An error has occurred. Please try again.
</div>  
{{/if}}

{{#if success}}
<div class="alert alert-success alert-dismissible fade show" role="alert">
  <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
  <strong>Success:</strong> The operation has been completed successfully.
</div>  
{{/if}}

<div class="row">
  <div class="col-md-6">
    <div class="card">
      <div class="card-header">
        <h5 class="card-title mb-0">Category Information</h5>
      </div>
      <div class="card-body">
        <table class="table table-borderless">
          <tr>
            <th width="40%">ID:</th>
            <td><strong>#{{category.id}}</strong></td>
          </tr>
          <tr>
            <th>Category Name:</th>
            <td>{{category.name}}</td>
          </tr>
          <tr>
            <th>Type:</th>
            <td>
              {{#if category.parent_id}}
                <span class="badge bg-secondary">Subcategory</span>
              {{else}}
                <span class="badge bg-primary">Parent Category</span>
              {{/if}}
            </td>
          </tr>
          {{#if category.parent_id}}
          <tr>
            <th>Parent Category:</th>
            <td>{{category.parent_id}}</td>
          </tr>
          {{/if}}
        </table>
      </div>
    </div>
  </div>

  <div class="col-md-6">
    <div class="card">
      <div class="card-header">
        <h5 class="card-title mb-0">Statistics</h5>
      </div>
      <div class="card-body">
        <div class="mb-3">
          <h6>Number of Courses: <span class="badge bg-info">{{category.course_count}}</span></h6>
          <h6>Number of Subcategories: <span class="badge bg-success">{{category.children_count}}</span></h6>
        </div>

        {{#if category.children.length}}
        <div class="mt-3">
          <h6>Subcategories:</h6>
          <ul class="list-unstyled">
            {{#each category.children}}
            <li class="mb-1">
              <i class="bi bi-arrow-return-right"></i> {{name}}
            </li>
            {{/each}}
          </ul>
        </div>
        {{/if}}
      </div>
    </div>
  </div>
</div>

<div class="row mt-4">
  <div class="col-12">
    <div class="card">
      <div class="card-header d-flex justify-content-between align-items-center">
        <h5 class="card-title mb-0">Actions</h5>
      </div>
      <div class="card-body">
        <div class="d-flex gap-2">
          <a href="/admin/categories/edit/{{category.id}}" class="btn btn-warning">
            <i class="bi bi-pencil"></i> Edit
          </a>
          <form method="post" action="/admin/categories/delete/{{category.id}}" class="d-inline frmDeleteCategory" 
                data-category-id="{{category.id}}" 
                data-category-name="{{category.name}}">
            <button type="submit" class="btn btn-danger">
              <i class="bi bi-trash"></i> Delete
            </button>
          </form>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
// Confirm category deletion
document.querySelectorAll('.frmDeleteCategory').forEach(form => {
  form.addEventListener('submit', async function(e) {
    e.preventDefault();
    
    const categoryId = this.getAttribute('data-category-id');
    const categoryName = this.getAttribute('data-category-name');
    
    try {
      const response = await fetch(`/admin/categories/${categoryId}/check-delete`);
      const data = await response.json();
      
      if (data.canDelete) {
        if (confirm(`Are you sure you want to delete the category "${categoryName}"?`)) {
          this.submit();
        }
      } else {
        let message = `Cannot delete category "${categoryName}" because:`;
        
        if (data.courseCount > 0) {
          message += `\n- Has ${data.courseCount} courses`;
        }
        
        if (data.childrenCount > 0) {
          message += `\n- Has ${data.childrenCount} subcategories`;
        }
        
        message += `\n\nPlease move or delete the courses and subcategories first.`;
        
        alert(message);
      }
    } catch (error) {
      console.error('Error checking category deletion:', error);
      alert('An error occurred while checking category deletion possibility');
    }
  });
});
</script>