<div class="container-fluid py-4">

  <!-- Page Header -->
  <div class="d-flex justify-content-between align-items-center mb-4">
    <h3 class="fw-semibold">{{title}}</h3>
    <a href="/admin/categories" class="btn btn-outline-secondary btn-sm">
      <i class="bi bi-arrow-left"></i> Back
    </a>
  </div>

  <!-- Alerts -->
  {{#if error}}
  <div class="alert alert-danger alert-dismissible fade show" role="alert">
    <strong>Error:</strong> Something went wrong. Please try again.
    <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
  </div>
  {{/if}}

  {{#if success}}
  <div class="alert alert-success alert-dismissible fade show" role="alert">
    <strong>Success:</strong> Operation completed successfully.
    <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
  </div>
  {{/if}}

  <div class="row g-4">

    <!-- Left Card: Category Info -->
    <div class="col-md-6">
      <div class="card shadow-sm border-0">
        <div class="card-body">
          <h5 class="fw-semibold mb-3">Category Information</h5>

          <table class="table table-borderless mb-0">
            <tr>
              <th class="text-muted" width="40%">ID</th>
              <td><strong>#{{category.id}}</strong></td>
            </tr>
            <tr>
              <th class="text-muted">Category Name</th>
              <td>{{category.name}}</td>
            </tr>
            <tr>
              <th class="text-muted">Type</th>
              <td>
                {{#if category.parent_id}}
                <span class="badge bg-secondary">Subcategory</span>
                {{else}}
                <span class="badge bg-primary">Parent Category</span>
                {{/if}}
              </td>
            </tr>
            {{#if category.parent_id}}
            <tr>
              <th class="text-muted">Parent Category</th>
              <td>#{{category.parent_id}}</td>
            </tr>
            {{/if}}
          </table>
        </div>
      </div>
    </div>

    <!-- Right Card: Statistics -->
    <div class="col-md-6">
      <div class="card shadow-sm border-0">
        <div class="card-body">
          <h5 class="fw-semibold mb-3">Statistics</h5>

          <p class="mb-1">
            Courses: <span class="badge bg-info">{{category.course_count}}</span>
          </p>

          <p>
            Subcategories: <span class="badge bg-success">{{category.children_count}}</span>
          </p>

          {{#if category.children.length}}
          <div class="mt-3">
            <h6 class="fw-semibold">Subcategory List</h6>
            <ul class="list-unstyled mt-2">
              {{#each category.children}}
              <li class="mb-1">
                <i class="bi bi-arrow-return-right"></i> {{name}}
              </li>
              {{/each}}
            </ul>
          </div>
          {{/if}}
        </div>
      </div>
    </div>

  </div>

  <!-- Actions -->
  <div class="card shadow-sm border-0 mt-4">
    <div class="card-body d-flex gap-2">
      <a href="/admin/categories/edit/{{category.id}}" class="btn btn-primary">
        <i class="bi bi-pencil"></i> Edit
      </a>

      <form method="post" action="/admin/categories/delete/{{category.id}}" class="frmDeleteCategory d-inline"
        data-category-id="{{category.id}}" data-category-name="{{category.name}}">
        <button type="submit" class="btn btn-danger">
          <i class="bi bi-trash"></i> Delete
        </button>
      </form>
    </div>
  </div>

</div>

<script>
  document.querySelectorAll('.frmDeleteCategory').forEach(form => {
    form.addEventListener('submit', async function (e) {
      e.preventDefault();

      const categoryId = this.dataset.categoryId;
      const categoryName = this.dataset.categoryName;

      try {
        const res = await fetch(`/admin/categories/${categoryId}/check-delete`);
        const data = await res.json();

        if (data.canDelete) {
          if (confirm(`Are you sure you want to delete category "${categoryName}"?`)) {
            this.submit();
          }
        } else {
          let msg = `Cannot delete "${categoryName}" because:\n`;
          if (data.courseCount > 0) msg += `- It contains ${data.courseCount} courses\n`;
          if (data.childrenCount > 0) msg += `- It has ${data.childrenCount} subcategories\n`;
          msg += `\nPlease remove or reassign related items first.`;
          alert(msg);
        }

      } catch (err) {
        alert("Error checking category deletion.");
        console.error(err);
      }
    });
  });
</script>