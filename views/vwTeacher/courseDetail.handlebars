<div class="container my-5">
    <!-- Header v·ªõi n√∫t quay l·∫°i -->
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h1 class="text-primary">Chi ti·∫øt kh√≥a h·ªçc</h1>
        <a href="/teacher/dashboard" class="btn btn-secondary">
            <i class="fas fa-arrow-left"></i> Quay l·∫°i Dashboard
        </a>
    </div>

    <!-- Th√¥ng tin c∆° b·∫£n -->
    <div class="card mb-4">
        <div class="card-header bg-primary text-white">
            <h4 class="mb-0"><i class="fas fa-info-circle"></i> Th√¥ng tin c∆° b·∫£n</h4>
        </div>
        <div class="card-body">
            <div class="row">
                <!-- ·∫¢nh b√¨a -->
                <div class="col-md-4 mb-3">
                   {{#if course.image_url}}
    <img src="{{course.image_url}}" alt="{{course.title}}" class="img-fluid rounded shadow">
{{else}}
    <img src="/static/images/default-course.jpg" alt="Kh√¥ng c√≥ ·∫£nh" class="img-fluid rounded shadow">
{{/if}}

                </div>
                
                <!-- Th√¥ng tin chi ti·∫øt -->
                <div class="col-md-8">
                    <table class="table table-bordered">
                        <tbody>
                            <tr>
                                <th width="200">T√™n kh√≥a h·ªçc:</th>
                                <td><strong>{{course.title}}</strong></td>
                            </tr>
                            <tr>
                                <th>M√¥ t·∫£ ng·∫Øn:</th>
                                <td>{{course.short_description}}</td>
                            </tr>
                            <tr>
                                <th>Danh m·ª•c:</th>
                                <td>
                                    {{#if course.category_name}}
                                        <span class="badge bg-info">{{course.category_name}}</span>
                                    {{else}}
                                        <span class="text-muted">Ch∆∞a ph√¢n lo·∫°i</span>
                                    {{/if}}
                                </td>
                            </tr>
                            <tr>
                                <th>Gi√° g·ªëc:</th>
                                <td><strong class="text-success">{{formatNumber course.price}} VNƒê</strong></td>
                            </tr>
                            <tr>
                                <th>Gi√° khuy·∫øn m√£i:</th>
                                <td>
                                    {{#if course.promotional_price}}
                                        <strong class="text-danger">{{formatNumber course.promotional_price}} VNƒê</strong>
                                    {{else}}
                                        <span class="text-muted">Kh√¥ng c√≥</span>
                                    {{/if}}
                                </td>
                            </tr>
                            <tr>
                                <th>Tr·∫°ng th√°i:</th>
                                <td>
                                    {{#ifEquals course.status "published"}}
                                        <span class="badge bg-success">ƒê√£ xu·∫•t b·∫£n</span>
                                    {{else}}
                                        <span class="badge bg-warning">Nh√°p</span>
                                    {{/ifEquals}}
                                </td>
                            </tr>
                            
                            <tr>
  <th>üë• L∆∞·ª£t ƒëƒÉng k√Ω:</th>
  <td><strong>{{total_students}}</strong> h·ªçc vi√™n</td>
</tr>

<tr>
  <th>‚≠ê ƒê√°nh gi√° trung b√¨nh:</th>
  <td>
    {{#if average_rating}}
      <span class="text-warning">
        <i class="fas fa-star"></i> {{average_rating}} / 5
      </span>
      <small class="text-muted">({{rating_count}} ƒë√°nh gi√°)</small>
    {{else}}
      <span class="text-muted">Ch∆∞a c√≥ ƒë√°nh gi√°</span>
    {{/if}}
  </td>
</tr>

<tr>
  <th>‚ù§Ô∏è Y√™u th√≠ch:</th>
  <td>{{watchlist_count}} l∆∞·ª£t th√™m v√†o danh s√°ch y√™u th√≠ch</td>
</tr>

                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <!-- M√¥ t·∫£ chi ti·∫øt -->
    <div class="card mb-4">
        <div class="card-header bg-info text-white">
            <h4 class="mb-0"><i class="fas fa-align-left"></i> M√¥ t·∫£ chi ti·∫øt</h4>
        </div>
        <div class="card-body">
            <div class="course-description">
                {{#if course.detailed_description}}
                    {{{course.detailed_description}}}
                {{else}}
                    <p class="text-muted">Ch∆∞a c√≥ m√¥ t·∫£ chi ti·∫øt</p>
                {{/if}}
            </div>
        </div>
    </div>
    {{#if comments.length}}
<div class="card mb-4">
  <div class="card-header bg-secondary text-white">
    <h4 class="mb-0"><i class="fas fa-comments"></i> Nh·∫≠n x√©t c·ªßa h·ªçc vi√™n</h4>
  </div>
  <div class="card-body">
    {{#each comments}}
      <div class="border-bottom pb-3 mb-3">
        <div class="d-flex align-items-center mb-2">
          <img src="{{this.profile_picture_url}}" alt="avatar" class="rounded-circle me-2" width="40" height="40">
          <strong>{{this.full_name}}</strong>
          <span class="ms-2 text-warning"><i class="fas fa-star"></i> {{this.rating}}</span>
        </div>
        <p class="mb-1">{{this.comment}}</p>
        <small class="text-muted">{{this.created_at}}</small>
      </div>
    {{/each}}
  </div>
</div>
{{/if}}

<!-- Th√¥ng tin gi·∫£ng vi√™n -->
<div class="card mb-4">
  <div class="card-header bg-warning text-dark">
    <h4 class="mb-0"><i class="fas fa-chalkboard-teacher"></i> Th√¥ng tin gi·∫£ng vi√™n</h4>
  </div>
  <div class="card-body">
    <div class="row align-items-center">
      <div class="col-md-2 text-center">
        {{#if course.instructor_avatar}}
          <img id="instructorAvatar" src="{{course.instructor_avatar}}" alt="{{course.instructor_name}}" 
               class="rounded-circle img-thumbnail"
               style="width: 100px; height: 100px; object-fit: cover;">
        {{else}}
          <img id="instructorAvatar" src="/static/images/default-avatar.png" alt="Avatar"
               class="rounded-circle img-thumbnail"
               style="width: 100px; height: 100px; object-fit: cover;">
        {{/if}}
      </div>

      <div class="col-md-10">
        <h5 class="fw-bold">{{course.instructor_name}}</h5>

        {{#if course.email}}
          <p class="text-muted mb-2">
            <i class="fas fa-envelope"></i> <strong>Email:</strong> {{course.email}}
          </p>
        {{/if}}

        {{#if course.instructor_bio}}
          <div class="mt-3">
            <strong>Gi·ªõi thi·ªáu:</strong>
            <p class="mt-2">{{course.instructor_bio}}</p>
          </div>
        {{/if}}
      </div>
    </div>
  </div>
</div>


    <!-- N·ªôi dung kh√≥a h·ªçc (Chapters & Lectures) -->
    <div class="card mb-4">
        <div class="card-header bg-success text-white">
            <h4 class="mb-0"><i class="fas fa-book"></i> N·ªôi dung kh√≥a h·ªçc</h4>
        </div>
        <div class="card-body">
            {{#if chapters}}
                <div class="accordion" id="courseContent">
                    {{#each chapters}}
                        <div class="accordion-item mb-2">
                            <h2 class="accordion-header" id="heading{{id}}">
                                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapse{{id}}">
                                    <strong>Ch∆∞∆°ng {{chapter_order}}: {{title}}</strong>
                                    <span class="badge bg-primary ms-2">
                                        {{length (lookup ../lectures id)}} b√†i gi·∫£ng
                                    </span>
                                </button>
                            </h2>
                            <div id="collapse{{id}}" class="accordion-collapse collapse" data-bs-parent="#courseContent">
                                <div class="accordion-body">
                                    {{#if (lookup ../lectures id)}}
                                        <ol class="list-group list-group-numbered">
                                            {{#each (lookup ../lectures id)}}
                                                <li class="list-group-item d-flex justify-content-between align-items-start">
                                                    <div class="ms-2 me-auto">
                                                        <div class="fw-bold">{{title}}</div>
                                                        {{#if video_url}}
                                                            <small class="text-muted">
                                                                <i class="fas fa-video"></i> Video: {{video_url}}
                                                            </small>
                                                        {{/if}}
                                                        {{#if duration_minutes}}
                                                            <small class="text-muted ms-2">
                                                                <i class="fas fa-clock"></i> {{duration_minutes}} ph√∫t
                                                            </small>
                                                        {{/if}}
                                                    </div>
                                                </li>
                                            {{/each}}
                                        </ol>
                                    {{else}}
                                        <p class="text-muted mb-0">Ch∆∞a c√≥ b√†i gi·∫£ng n√†o trong ch∆∞∆°ng n√†y</p>
                                    {{/if}}
                                </div>
                            </div>
                        </div>
                    {{/each}}
                </div>
            {{else}}
                <div class="alert alert-warning">
                    <i class="fas fa-exclamation-triangle"></i> Kh√≥a h·ªçc ch∆∞a c√≥ ch∆∞∆°ng n√†o. H√£y th√™m ch∆∞∆°ng v√† b√†i gi·∫£ng!
                </div>
            {{/if}}
        </div>
    </div>

    <!-- N√∫t h√†nh ƒë·ªông -->
    <div class="d-flex gap-2 justify-content-end">
        <a href="/teacher/course/{{course.id}}/edit" class="btn btn-primary btn-lg">
            <i class="fas fa-edit"></i> Ch·ªânh s·ª≠a kh√≥a h·ªçc
        </a>
        <form method="POST" action="/teacher/course/{{course.id}}/delete" style="display: inline;" 
              onsubmit="return confirm('‚ö†Ô∏è B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën x√≥a kh√≥a h·ªçc n√†y?\n\nTo√†n b·ªô ch∆∞∆°ng, b√†i gi·∫£ng v√† d·ªØ li·ªáu li√™n quan s·∫Ω b·ªã x√≥a vƒ©nh vi·ªÖn!');">
            <button type="submit" class="btn btn-danger btn-lg">
                <i class="fas fa-trash"></i> X√≥a kh√≥a h·ªçc
            </button>
        </form>
    </div>
</div>
<script>
document.addEventListener('DOMContentLoaded', async () => {
  const avatar = document.getElementById('instructorAvatar');
  if (!avatar) return;

  try {
    const res = await fetch('/api/user/profile'); // G·ªçi API l·∫•y th√¥ng tin ng∆∞·ªùi d√πng hi·ªán t·∫°i
    if (!res.ok) return;

    const data = await res.json();
    if (data && data.profile_picture_url) {
      avatar.src = data.profile_picture_url; // C·∫≠p nh·∫≠t ·∫£nh gi·∫£ng vi√™n m·ªõi nh·∫•t
    }
  } catch (err) {
    console.error('Kh√¥ng th·ªÉ t·∫£i ·∫£nh gi·∫£ng vi√™n:', err);
  }
});
</script>
<script>
document.addEventListener('DOMContentLoaded', async () => {
  const coverImg = document.querySelector('.img-fluid.rounded.shadow');
  if (!coverImg) return;

  try {
    const courseId = "{{course.id}}"; // l·∫•y id kh√≥a h·ªçc hi·ªán t·∫°i
    const res = await fetch(`/api/courses/${courseId}`); // g·ªçi API ƒë·ªÉ l·∫•y th√¥ng tin m·ªõi nh·∫•t
    if (!res.ok) return;

    const data = await res.json();
    if (data && data.image_url) {
      // n·∫øu c√≥ ·∫£nh b√¨a m·ªõi th√¨ c·∫≠p nh·∫≠t
      coverImg.src = data.image_url.startsWith('/uploads/')
        ? data.image_url
        : `/uploads/${data.image_url}`;
    }
  } catch (err) {
    console.error('Kh√¥ng th·ªÉ t·∫£i ·∫£nh b√¨a kh√≥a h·ªçc:', err);
  }
});
</script>

<style>
.course-description {
    line-height: 1.8;
    font-size: 1rem;
}

.accordion-button:not(.collapsed) {
    background-color: #e7f3ff;
    color: #0056b3;
}

.list-group-item {
    border-left: 3px solid #28a745;
}

.card-header h4 {
    font-weight: 600;
}

table th {
    background-color: #f8f9fa;
    font-weight: 600;
}
</style>