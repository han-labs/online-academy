{{!-- vwTeacher/profile.handlebars --}}

<div class="container my-5">
  <h2 class="mb-4 text-primary fw-bold text-center">Hồ Sơ Giảng Viên</h2>

  <form action="/teacher/profile" method="POST" enctype="multipart/form-data" class="shadow p-4 rounded bg-light mb-5">
    
    <div class="row">
      <!-- Ảnh đại diện -->
      <div class="col-md-4 text-center mb-3">
        <label class="fw-semibold d-block mb-2">Ảnh đại diện</label>
       {{#if user.profile_picture_url}}
  <img src="{{user.profile_picture_url}}" 
       alt="Avatar" 
       class="img-thumbnail rounded-circle mb-3" 
       style="width: 150px; height: 150px; object-fit: cover;">
{{else}}
  <img src="/images/default-avatar.png" 
       alt="Avatar" 
       class="img-thumbnail rounded-circle mb-3" 
       style="width: 150px; height: 150px; object-fit: cover;">
{{/if}}
        <input type="file" name="profile_picture" class="form-control" accept="image/*">
        <small class="text-muted">Ảnh sẽ hiển thị trong phần giới thiệu giảng viên</small>
      </div>

      <!-- Thông tin cơ bản -->
      <div class="col-md-8">
        <div class="mb-3">
          <label class="fw-semibold">Họ và tên <span class="text-danger">*</span></label>
          <input type="text" name="full_name" class="form-control" value="{{user.full_name}}" required>
        </div>

        <div class="mb-3">
          <label class="fw-semibold">Email</label>
          <input type="email" name="email" class="form-control" value="{{user.email}}" required readonly>
          <small class="text-muted">Email không thể thay đổi</small>
        </div>
      </div>
    </div>

    <div class="mb-3">
      <label class="fw-semibold">Giới thiệu bản thân <span class="text-danger">*</span></label>
      <textarea name="bio" class="form-control" rows="5" placeholder="Chia sẻ về kinh nghiệm giảng dạy, thành tích, kỹ năng..." required>{{user.instructor_bio}}</textarea>
      <small class="text-muted">Thông tin này sẽ hiển thị cho học viên khi xem khóa học của bạn</small>
    </div>

    <button type="submit" class="btn btn-success w-100 mt-2">
      <i class="bi bi-check-circle"></i> Cập nhật hồ sơ
    </button>
  </form>

  <hr class="my-5">

  <h3 class="text-secondary mb-3">
    <i class="bi bi-easel"></i> Khóa học của bạn
  </h3>

  {{#if courses.length}}
  <table class="table table-striped table-hover align-middle shadow-sm">
    <thead class="table-primary">
      <tr>
        <th>#</th>
        <th>Khóa học</th>
        <th>Trạng thái</th>
        <th>Hành động</th>
      </tr>
    </thead>
    <tbody>
      {{#each courses}}
      <tr>
        <td>{{add @index 1}}</td>
        <td>{{title}}</td>
        <td>
          {{#if (eq status "published")}}
            <span class="badge bg-success">Published</span>
          {{else if (eq status "completed")}}
            <span class="badge bg-info">Completed</span>
          {{else if (eq status "draft")}}
            <span class="badge bg-warning text-dark">Draft</span>
          {{else}}
            <span class="badge bg-secondary">Không xác định</span>
          {{/if}}
        </td>
        <td>
          <a href="/teacher/course/{{id}}/detail" class="btn btn-info btn-sm">Chi tiết</a>
          <a href="/teacher/course/{{id}}/edit" class="btn btn-warning btn-sm">Sửa</a>
          <form action="/teacher/profile/course/{{id}}/delete" method="POST" style="display:inline;"
                onsubmit="return confirm('Bạn có chắc chắn muốn xóa khóa học này không?');">
            <button type="submit" class="btn btn-danger btn-sm">Xóa</button>
          </form>
        </td>
      </tr>
      {{/each}}
    </tbody>
  </table>
  {{else}}
    <div class="alert alert-info text-center">
      <i class="bi bi-info-circle"></i> Bạn chưa đăng khóa học nào.
    </div>
  {{/if}}
</div>
<script>
  document.addEventListener("DOMContentLoaded", function () {
    const fileInput = document.querySelector('input[name="profile_picture"]');
    const avatarImg = document.querySelector('.img-thumbnail');

    if (fileInput && avatarImg) {
      fileInput.addEventListener('change', (event) => {
        const file = event.target.files[0];
        if (file) {
          const reader = new FileReader();
          reader.onload = (e) => {
            avatarImg.src = e.target.result; // Hiển thị ảnh vừa chọn
          };
          reader.readAsDataURL(file);
        }
      });
    }
  });
</script>