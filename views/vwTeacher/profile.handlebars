{{!-- vwTeacher/profile.handlebars --}}

<div class="container my-5">
  <h2 class="mb-4 text-primary fw-bold text-center">Instructor Profile</h2>

  <form action="/teacher/profile" method="POST" enctype="multipart/form-data" class="shadow p-4 rounded bg-light mb-5">
    
    <div class="row">
      <!-- Avatar -->
      <div class="col-md-4 text-center mb-3">
        <label class="fw-semibold d-block mb-2">Profile Picture</label>
       {{#if user.profile_picture_url}}
  <img src="{{user.profile_picture_url}}" 
       alt="Avatar" 
       class="img-thumbnail rounded-circle mb-3" 
       style="width: 150px; height: 150px; object-fit: cover;">
{{else}}
  <img src="/images/default-avatar.png" 
       alt="Avatar" 
       class="img-thumbnail rounded-circle mb-3" 
       style="width: 150px; height: 150px; object-fit: cover;">
{{/if}}
        <input type="file" name="profile_picture" class="form-control" accept="image/*">
        <small class="text-muted">This picture will appear in your instructor profile</small>
      </div>

      <!-- Basic Info -->
      <div class="col-md-8">
        <div class="mb-3">
          <label class="fw-semibold">Full Name <span class="text-danger">*</span></label>
          <input type="text" name="full_name" class="form-control" value="{{user.full_name}}" required>
        </div>

        <div class="mb-3">
          <label class="fw-semibold">Email</label>
          <input type="email" name="email" class="form-control" value="{{user.email}}" required readonly>
          <small class="text-muted">Email cannot be changed</small>
        </div>
      </div>
    </div>

    <div class="mb-3">
      <label class="fw-semibold">Bio <span class="text-danger">*</span></label>
      <textarea name="bio" class="form-control" rows="5" placeholder="Share your teaching experience, achievements, skills..." required>{{user.instructor_bio}}</textarea>
      <small class="text-muted">This information will be visible to students on your courses</small>
    </div>

    <button type="submit" class="btn btn-success w-100 mt-2">
      <i class="bi bi-check-circle"></i> Update Profile
    </button>
  </form>

  <hr class="my-5">

  <h3 class="text-secondary mb-3">
    <i class="bi bi-easel"></i> Your Courses
  </h3>

  {{#if courses.length}}
  <table class="table table-striped table-hover align-middle shadow-sm">
    <thead class="table-primary">
      <tr>
        <th>#</th>
        <th>Course</th>
        <th>Status</th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody>
      {{#each courses}}
      <tr>
        <td>{{add @index 1}}</td>
        <td>{{title}}</td>
        <td>
          {{#if (eq status "published")}}
            <span class="badge bg-success">Published</span>
          {{else if (eq status "completed")}}
            <span class="badge bg-info">Completed</span>
          {{else if (eq status "draft")}}
            <span class="badge bg-warning text-dark">Draft</span>
          {{else}}
            <span class="badge bg-secondary">Unknown</span>
          {{/if}}
        </td>
        <td>
          <a href="/teacher/course/{{id}}/detail" class="btn btn-info btn-sm">Details</a>
          <a href="/teacher/course/{{id}}/edit" class="btn btn-warning btn-sm">Edit</a>
          <form action="/teacher/profile/course/{{id}}/delete" method="POST" style="display:inline;"
                onsubmit="return confirm('Are you sure you want to delete this course?');">
            <button type="submit" class="btn btn-danger btn-sm">Delete</button>
          </form>
        </td>
      </tr>
      {{/each}}
    </tbody>
  </table>
  {{else}}
    <div class="alert alert-info text-center">
      <i class="bi bi-info-circle"></i> You have not published any courses yet.
    </div>
  {{/if}}
</div>

<script>
  document.addEventListener("DOMContentLoaded", function () {
    const fileInput = document.querySelector('input[name="profile_picture"]');
    const avatarImg = document.querySelector('.img-thumbnail');

    if (fileInput && avatarImg) {
      fileInput.addEventListener('change', (event) => {
        const file = event.target.files[0];
        if (file) {
          const reader = new FileReader();
          reader.onload = (e) => {
            avatarImg.src = e.target.result; // Preview selected image
          };
          reader.readAsDataURL(file);
        }
      });
    }
  });
</script>
